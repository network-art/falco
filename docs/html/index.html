<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>falco: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">falco
   </div>
   <div id="projectbrief">C library for developing embedded and network applications</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">falco Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Falco is a collection of modules that help engineers quickly develop embedded and network-based applications in C. Falco helps build high-performance applications. Applications that run on embedded devices, IoT gateways, desktops and servers.</p>
<h1>About Falco Library</h1>
<p>Falco is the reincarnation of the erstwhile SVUtils (<a href="https://networkart.com">SupportVantage</a> Utils) library that we built for our <a href="https://networkart.com/products/supportvantage">product SupportVantage</a>. The bird family "Falco Peregrinus" is the inspiration for the name "Falco". <a href="https://en.wikipedia.org/wiki/Peregrine_falcon">Peregrine Falcon</a>, the fastest bird, belongs to this family.</p>
<h1>Motivation</h1>
<p>SVAgent (SupportVantage Agent), a component of our product, has many modules. Each module runs as a process/daemon. All modules have the same infrastructural requirements. Some of them are listed below.</p>
<ul>
<li>Provide simple API for logging via Syslog (with controls for setting log level/priority).</li>
<li>Signal handling management. E.g. apps must be able to register a signal handler to terminate itself when it receives SIGTERM.</li>
<li>Timer management. The ability to create and manage timers with timeout intervals and timeout handlers.</li>
<li>Socket management. The ability to create and manage sockets (INET, INET6) with support for different types (raw, datagram and stream). Support for blocking and non-blocking send and receive.</li>
<li>Manage read, write and except bits for select() and epoll().</li>
<li>Task management, along with task scheduling based on priority.</li>
</ul>
<p>Falco addresses these and many other infrastructural requirements. It reduces boilerplate code in applications.</p>
<p>Falco is inspired by and is similar in style to the excellent task management infrastructure of GateD. GateD was an open-source routing daemon project developed by the Merit Consortium, Inc at the University of Michigan at Ann Arbor, in the 90s and early 2000. However, Falco differs from GateD's task infrastructure in many ways. Task is the primary infrastructure object in GateD. Other objects (such as sockets, timers) are associated with the task object. In Falco, the task object is not mandatory for managing objects such as sockets, timers. This notable difference changes the nature of the application programming interfaces (APIs).</p>
<h1>Modules in Falco</h1>
<h2>Process</h2>
<p>A small component that provides the following functionalities:</p>
<ul>
<li>Convenience function to initialize all Falco modules.</li>
<li>Record (when process runs as a daemon) and close/delete PID files (upon termination).</li>
<li>Convenience function to dump state and statistics of all Falco modules.</li>
</ul>
<h2>Task</h2>
<p>A simple task management module.</p>
<ul>
<li>An app can create and manage tasks. Tasks have priorities. Three levels of priorities are currently supported.</li>
<li>Apps can schedule tasks in their main loop.</li>
</ul>
<h2>Socket</h2>
<p>A comprehensive sockets management framework. Apps can quickly realize features for network-based applications.</p>
<p>The socket module APIs provide argument parity with the standard BSD/Linux socket APIs. For example,</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> socket(<span class="keywordtype">int</span> domain, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> protocol)</div></div><!-- fragment --><p>The Falco API is:</p>
<div class="fragment"><div class="line"><a class="code" href="structfl__socket__t__.html">fl_socket_t</a> *<a class="code" href="fl__socket_8h.html#aa900c7b1fd7ca8ae20de96b148ff0934">fl_socket_socket</a>(<span class="keyword">struct</span> <a class="code" href="structfl__task__t__.html">fl_task_t_</a> *task, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> domain, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> protocol)</div></div><!-- fragment --><p>The task argument is optional, while the name argument is mandatory.</p>
<p>Some features are listed below.</p>
<ul>
<li>Ability to bind, listen and accept connections.</li>
<li>Support for one transmit buffer and one receive buffer. We intend to add support for more than one transmit buffers.</li>
<li>Support for blocking and non-blocking transmit and receive across socket types (raw, datagram and stream).</li>
<li>Apps can register call back functions for non-blocking transmit and receive.</li>
<li>Falco provides ready-made non-blocking transmission and receive functions. Apps can focus on the actual functionality and reduce boilerplate code.</li>
</ul>
<h2>Timer</h2>
<p>The timer module uses the timerfd infrastructure in Linux. Apps can handle timer fires in <code>select()</code> or <code>epoll()</code>.</p>
<p>Functionality includes: creating, starting (arming), stopping (disarming) and deleting timers. Apps can register timeout handlers with contextual data.</p>
<h2>Signal</h2>
<p>The signal module is a small module that allows apps to register signal handlers to signals. For example, <code>app_terminate()</code> method for signal <code>SIGTERM</code>.</p>
<p>Apps can control the timer dispatches (i.e. timeout handlers) from their main loop.</p>
<h2>File Descriptors (FD)</h2>
<p>The Falco socket and timer modules use the FD module internally. Apps can also use the FD module to get the current read, write and except bits.</p>
<h2>Logging and Tracing</h2>
<p>The logr module provides a simple API set for logging via <a href="https://en.wikipedia.org/wiki/Syslog">Syslog</a>. The tracevalue module provides mechanisms to trace/print integer and bit values.</p>
<h1>Style and Code Conventions</h1>
<p>File names reflect the name of the module. For example, fl_fds.c provides the File Descriptors management functionality. File names, constants, function names, global variables and other entities contain the Falco library (<code>fl_</code>) prefix.</p>
<p>Falco does not provide definitions for basic data types (such as character, 16-bit, 32-bit, 64-bit integers). Instead, <code>sys/types.h</code> is used to get the definitions. Header file <code>sys/param.h</code> provides constants for maximum path length, line length and other such constants.</p>
<p>Falco employs <code>assert()</code> (via <code>FL_ASSERT</code>) extensively to help engineers catch bugs and mistakes at the earliest. Apps can also use <code><a class="el" href="fl__stdlib_8h.html#afc98d2457e0eaafbd0e9ae89d76d1364" title="Abort the program if the assertion is false. ">FL_ASSERT()</a></code>.</p>
<h1>Building</h1>
<p>Falco supports native and cross-platform builds. GNU Autotools, and cmake based build methods are supported.</p>
<h2>Build using cmake</h2>
<p>For example,</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;% mkdir build/${TOOLCHAIN}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;% cd build/${TOOLCHAIN}</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;% cmake -DCMAKE_INSTALL_PREFIX=/usr ../..</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;% make</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;% make install</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;# You can also specify a destination directory for installation. For example, make DESTDIR=&lt;destination-directory&gt; install.</div></div><!-- fragment --><h2>Build using GNU Autotools method</h2>
<p>For example,</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;% ./autogen.sh</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;% mkdir -p build/${TOOLCHAIN}</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;% cd build/${TOOLCHAIN}</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;% ../../configure</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;% make</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;% make install</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;# You can also specify a destination directory for installation. For example, make DESTDIR=&lt;destination-directory&gt; install.</div></div><!-- fragment --><p>A static library archive (<code>${DESTDIR}/usr/lib/libfalco.a</code>) is available for the applications to link with. Header files are installed in <code>${DESTDIR}/usr/include</code>.</p>
<h1>Usage</h1>
<p>The following code snippet shows how apps can initialize with Falco library.</p>
<div class="fragment"><div class="line"><span class="keywordflow">do</span> {</div><div class="line">    <a class="code" href="fl__logr_8h.html#a4344fc40523fce6f55aa8248835207d5">fl_logr_openlog</a>(<span class="stringliteral">&quot;YOUR_APP_NAME&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (getuid()) {</div><div class="line">        <a class="code" href="fl__logr_8h.html#a97286ae998aac46691c2b591c9ec6713">FL_LOGR_CRIT</a>(<span class="stringliteral">&quot;%s must be run as root or with sudo privileges, exiting.\n&quot;</span>,</div><div class="line">                     progname);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (getppid() == 1) {</div><div class="line">        daemonize = FALSE;</div><div class="line">        <a class="code" href="fl__logr_8h.html#a185a91a7f1435bcfdbff7d354336a53b">FL_LOGR_INFO</a>(<span class="stringliteral">&quot;%s was started either via /etc/inittab or &quot;</span></div><div class="line">                     <span class="stringliteral">&quot;systemctl, will not daemonize&quot;</span>, progname);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (daemonize) {</div><div class="line">        <a class="code" href="fl__process_8h.html#a361e575ba429ad5bc836efbb76da77fe">fl_process_daemonize</a>();</div><div class="line">    }</div><div class="line"></div><div class="line">    pid_fd = <a class="code" href="fl__process_8h.html#a7801cf4bc8310d15ecca57b51e6afe4d">fl_process_open_pid_file</a>(progname);</div><div class="line">    <span class="keywordflow">if</span> (pid_fd &lt; 0) {</div><div class="line">        <a class="code" href="fl__logr_8h.html#a97286ae998aac46691c2b591c9ec6713">FL_LOGR_CRIT</a>(<span class="stringliteral">&quot;Could not open PID file or store PID, exiting.\n&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="fl__signal_8h.html#abb2a6653036be13dee3b4078f7737a57">fl_signal_register_handlers</a>(sighandlers) &lt; 0) {</div><div class="line">        <a class="code" href="fl__logr_8h.html#a97286ae998aac46691c2b591c9ec6713">FL_LOGR_CRIT</a>(<span class="stringliteral">&quot;Signal handlers registrations failed, exiting.&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="fl__process_8h.html#aed358361cff22556ebf2cd998d8d3843">fl_init</a>() &lt; 0) {</div><div class="line">        <a class="code" href="fl__logr_8h.html#a97286ae998aac46691c2b591c9ec6713">FL_LOGR_CRIT</a>(<span class="stringliteral">&quot;Falco library initialization failed, exiting.&quot;</span>);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    app_main_loop();</div><div class="line">} <span class="keywordflow">while</span>(0);</div><div class="line"></div><div class="line">app_shutdown(1);</div></div><!-- fragment --><p>The following code shows how apps can use Falco in their main loop.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_main_loop()</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> nfds_fired;</div><div class="line">    fd_set *rfds, *wfds, *efds;</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> (TRUE) {</div><div class="line">        <span class="comment">/* Sample set of signals to be blocked */</span></div><div class="line">        <span class="keywordtype">int</span> block_signals[] = { SIGUSR1, SIGUSR2, 0 };</div><div class="line">        <span class="keywordtype">int</span> signals_blocked = 0;</div><div class="line">        sigset_t signals_blockset;</div><div class="line"></div><div class="line">        <span class="comment">/* select() comes here */</span></div><div class="line">        nfds_fired = <a class="code" href="fl__socket_8h.html#a2afe54d4e1004a99eac112d855a88cf4">fl_socket_select</a>(&amp;rfds, &amp;wfds, &amp;efds);</div><div class="line">        <span class="keywordflow">if</span> (nfds_fired &lt; 0) {</div><div class="line">            <a class="code" href="fl__logr_8h.html#ab29e62a9f6118b7af1e16ced9dc46669">FL_LOGR_EMERG</a>(<span class="stringliteral">&quot;Sockets select() fired with error, exiting.&quot;</span>);</div><div class="line">            app_shutdown();</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* Block signals here */</span></div><div class="line">        signals_blocked = <a class="code" href="fl__signal_8h.html#afac44c6f7cdc930c8b47ae4e2ea22bac">fl_signals_block</a>(block_signals, &amp;signals_blockset);</div><div class="line"></div><div class="line">        <span class="comment">/* Process timer expirations */</span></div><div class="line">        <a class="code" href="fl__timer_8h.html#a9dbff92268cf5cf51252c276d023849f">fl_timers_dispatch</a>(&amp;nfds_fired, rfds);</div><div class="line"></div><div class="line">        <span class="comment">/* Process sockets ready for read */</span></div><div class="line">        <span class="keywordflow">if</span> (nfds_fired) {</div><div class="line">            <a class="code" href="fl__socket_8h.html#af0df6de151852cb197b5b58610d4514b">fl_socket_process_reads</a>(&amp;nfds_fired, rfds);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* Process sockets ready for write */</span></div><div class="line">        <span class="keywordflow">if</span> (nfds_fired) {</div><div class="line">            <a class="code" href="fl__socket_8h.html#a6cb099a973bda9b8b5ea03435e9498e1">fl_socket_process_writes</a>(&amp;nfds_fired, wfds);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* Process sockets ready for accept */</span></div><div class="line">        <span class="keywordflow">if</span> (nfds_fired) {</div><div class="line">            <a class="code" href="fl__socket_8h.html#a6311b8338250a34021a0ea6c93700a29">fl_socket_process_connections</a>(&amp;nfds_fired, rfds);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* Unblock signals that were previously blocked */</span></div><div class="line">        <span class="keywordflow">if</span> (signals_blocked) {</div><div class="line">            (void) <a class="code" href="fl__signal_8h.html#ab42e18a67654dab3dfa285994a45cfe1">fl_signals_unblock</a>(&amp;signals_blockset);</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>Code snippets that exemplify cleanup and shutdown procedures. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_shutdown(<span class="keywordtype">int</span> exit_code)</div><div class="line">{</div><div class="line">    app_cleanup();</div><div class="line">    exit(exit_code);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_cleanup()</div><div class="line">{</div><div class="line">    <span class="comment">/* Stop and close logging */</span></div><div class="line">    <span class="keywordflow">if</span> (logging_started) {</div><div class="line">        <a class="code" href="fl__logr_8h.html#af33c1fbec40b3ee8489a352349d1ae39">fl_logr_closelog</a>(progname);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Close and remove the PID file */</span></div><div class="line">    <span class="keywordflow">if</span> (pid_fd &gt;= 0) {</div><div class="line">        <a class="code" href="fl__process_8h.html#aa0963742852221cde7e4baf322092b05">fl_process_close_pid_file</a>(progname, pid_fd);</div><div class="line">        pid_fd = -1;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
